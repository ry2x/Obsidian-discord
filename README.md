# Obsidian-discord連携Bot

## 概要

日々のDiscordでのやり取りを、Obsidianでの知識管理にシームレスに繋げるための高機能ボットです。指定したチャンネルの会話を自動で記録・整形するだけでなく、AIを活用して日々のメモを要約・タグ付けし、関連ノートを自動生成することで、情報の整理と再発見を強力にサポートします。

## 主な機能

### 1. Discordメッセージの自動メモ化

- **リアルタイムでの自動記録**: `.env`で指定した特定のDiscordチャンネルへの投稿を、日付ごと（例: `2023-10-27.md`）のMarkdownファイルとして`memos`ディレクトリにリアルタイムで自動保存します。
- **コンテキストメニューからの手動追加**: 任意のチャンネルのメッセージを右クリックし、「アプリ」>「メモに追加」を選択することで、そのメッセージをその日のデイリーノートに手動で追加できます。

### 2. 情報の自動拡充と整形

- **URLの自動展開**: メッセージに含まれるURLのWebページのタイトルと説明を自動で取得し、メモに追記します。
- **画像の自動保存とリンク**: 添付された画像は`images`ディレクトリに自動で保存され、Obsidianで表示可能な形式（`![[画像ファイル名]]`）でメモに埋め込まれます。
- **スレッド対応**: メッセージがスレッドの親である場合、スレッドのタイトルとURLへのリンクを自動で記載し、議論の文脈を明確にします。
- **AIによる補足情報**: Gemini APIを利用し、投稿内容に基づいた関連情報や豆知識を「AI's Small Tip」として自動で追記し、知識の深化を促します。

### 3. AIによる高度な整理・要約

- **デイリーサマリーの自動生成**: 毎日深夜（デフォルト 00:05）、前日分のデイリーノートの内容をAIが分析し、要点をまとめた「まとめ」をノートの末尾に自動で追記します。
- **キーワード抽出とノート自動生成**: 会話の中から重要なキーワードをAIが自動で抽出し、それぞれのキーワードについて詳細な解説を記述した個別のノートを`notes`ディレクトリに自動生成します。
- **自動リンクによる知識のネットワーク化**: 生成されたキーワード解説ノートへのリンク（バックリンク）をデイリーノートに自動で追加します。これにより、Obsidian上で情報が有機的に繋がり、知識のネットワークが自然に構築されます。

### 4. コマンドによる手動操作

- **手動での要約実行**: ボットのオーナーはDiscord上で `/today_summary` コマンドを実行することで、任意のタイミングでその日のデイリーノートに対して要約・整理プロセス（上記3の機能）を手動で実行できます。

## セットアップ手順

1.  **リポジトリのクローン**: `git clone <repository_url>`
2.  **仮想環境の作成と有効化**: `python -m venv .venv && source .venv/bin/activate`
3.  **ライブラリのインストール**: `pip install -r requirements.txt`
4.  **.envファイルの準備**:
    `.env.template`をコピーして`.env`ファイルを作成します。
    ```bash
    cp .env.template .env
    ```
5.  **.envファイルの編集**:
    作成した`.env`ファイルを開き、ご自身の環境に合わせて以下の値を設定してください。
    ```env
    DISCORD_TOKEN="YOUR_DISCORD_BOT_TOKEN"
    GEMINI_API_KEY="YOUR_GOOGLE_API_KEY"
    LOG_LEVEL="INFO" # (任意) INFO, DEBUGなど
    CHANNEL_ID="YOUR_DISCORD_CHANNEL_ID"
    SAVE_DIR="./memos"
    IMAGE_SAVE_DIR="./images"
    NOTES_DIR="./notes"
    ```
    - `DISCORD_TOKEN`: お使いのDiscordボットのトークン。
    - `GEMINI_API_KEY`: Google AI Studioで取得したAPIキー。
    - `LOG_LEVEL`: (任意) ログレベルを指定します。デフォルトは`INFO`です。
    - `CHANNEL_ID`: 自動保存の対象とするDiscordチャンネルのID。
    - `SAVE_DIR`: メモ（.mdファイル）を保存するディレクトリのパス。
    - `IMAGE_SAVE_DIR`: 添付画像を保存するディレクトリのパス。
    - `NOTES_DIR`: AIが生成したタグ解説ノートを保存するディレクトリのパス。

6.  **ボットの実行**: `python main.py`

## 使用方法

- **メモを取る**: `config.py`で設定したチャンネルに投稿するか、任意のメッセージを右クリックして「メモに追加」を選択します。
- **１日のメモを整理する**: 自動実行を待つか、ボットのオーナーが `/today_summary` を実行します。
